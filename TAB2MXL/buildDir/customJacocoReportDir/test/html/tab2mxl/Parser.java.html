<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Parser.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TAB2MXL</a> &gt; <a href="index.source.html" class="el_package">tab2mxl</a> &gt; <span class="el_source">Parser.java</span></div><h1>Parser.java</h1><pre class="source lang-java linenums">package tab2mxl;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import gui_panels.TextInputContentPanel;
import gui_popups.SuccessPopUp;

public class Parser {

	int stringAmount;
	int tabLineAmount;
	private int beat;
	private int beatType;
	private ArrayList&lt;char[]&gt; columns;
	public static  Map&lt;String,String&gt; misc;
	private Tuning tunner;
	private FileGenerator fileGen;
	private double rest;
	private int totalDash;
	
	//@SuppressWarnings(&quot;unused&quot;)
<span class="nc" id="L24">	Parser(ArrayList&lt;ArrayList&lt;String&gt;&gt; input) {</span>
<span class="nc" id="L25">		stringAmount = 0;</span>
<span class="nc" id="L26">		tabLineAmount = 1;</span>
<span class="nc" id="L27">		misc = new HashMap&lt;String, String&gt;();</span>
		
<span class="nc" id="L29">		addTitle(TextInputContentPanel.getTitle());</span>
<span class="nc" id="L30">		addTabType(TextInputContentPanel.getTabType());</span>
<span class="nc" id="L31">		addTime(TextInputContentPanel.getTimeSig());</span>
		
		//set the time signature to default if the inputed time signature isn't in the right format
<span class="nc bnc" id="L34" title="All 2 branches missed.">		if(misc.get(&quot;TimeSig&quot;) == &quot;&quot;) {</span>
<span class="nc" id="L35">			beat = 4;</span>
<span class="nc" id="L36">			beatType = 4;</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">		}else if(misc.get(&quot;TimeSig&quot;).indexOf('/') == -1) {</span>
<span class="nc" id="L38">			beat = 4;</span>
<span class="nc" id="L39">			beatType = 4;</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">		}else if(misc.get(&quot;TimeSig&quot;).charAt(0) == '/') {</span>
<span class="nc" id="L41">			beat = 4;</span>
<span class="nc" id="L42">			beatType = 4;</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">		}else if(misc.get(&quot;TimeSig&quot;).charAt(misc.get(&quot;TimeSig&quot;).length()-1) == '/') {</span>
<span class="nc" id="L44">			beat  = 4;</span>
<span class="nc" id="L45">			beatType = 4;</span>
			//set the time signature to default if the inputed time signature isn't in the right format
		}else {
			//get the beat and beat-type from the information given in the time signature
			try{
<span class="nc" id="L50">				beat = Integer.parseInt(misc.get(&quot;TimeSig&quot;).substring(0, misc.get(&quot;TimeSig&quot;).indexOf('/')));</span>
<span class="nc" id="L51">				beatType = Integer.parseInt(misc.get(&quot;TimeSig&quot;).substring(misc.get(&quot;TimeSig&quot;).indexOf('/')+1));</span>
<span class="nc" id="L52">			}catch(NumberFormatException e) {</span>
<span class="nc" id="L53">				beat = 4;</span>
<span class="nc" id="L54">				beatType = 4;</span>
<span class="nc" id="L55">			}</span>
		}
//		System.out.println(&quot;beat: &quot; + beat);
//		System.out.println(&quot;beatType: &quot; + beatType);
		
<span class="nc bnc" id="L60" title="All 2 branches missed.">		for(int i = 0; i &lt; input.size(); i++) {			</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">			if(input.get(i).size() &lt; 2)</span>
<span class="nc" id="L62">				break;</span>
<span class="nc" id="L63">			stringAmount++;</span>
		}
		
<span class="nc bnc" id="L66" title="All 2 branches missed.">		for(int i = 0; i &lt; input.size(); i++) {</span>
<span class="nc bnc" id="L67" title="All 6 branches missed.">			if(input.get(i).size() &lt; 2 &amp;&amp; input.get(i-1).size() &gt; 2 &amp;&amp; i != input.size())</span>
<span class="nc" id="L68">				tabLineAmount++;</span>
		}
				
		//Transpose columns to rows (do you mean rows to col?)
<span class="nc" id="L72">		columns = new ArrayList&lt;char[]&gt;();</span>
		
<span class="nc bnc" id="L74" title="All 2 branches missed.">		for(int layer = 0; layer &lt; tabLineAmount; layer++) {</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">			for(int i = 2; i &lt; input.get((layer * stringAmount) + layer).size(); i++) {</span>
<span class="nc" id="L76">				columns.add(new char[stringAmount]);</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">				for(int l = 0; l &lt; stringAmount; l++) {</span>
<span class="nc" id="L78">					columns.get(columns.size()-1)[l] = input.get(l + (layer * stringAmount) + layer).get(i).charAt(0);</span>
				}
					}		
		}

<span class="nc" id="L83">		char[] chords = new char[stringAmount];</span>
<span class="nc" id="L84">		int[] chordsOctave = new int[stringAmount];</span>
<span class="nc" id="L85">		String chordType= &quot;&quot;;</span>
<span class="nc" id="L86">		int[] chordDot = new int[stringAmount];		</span>
<span class="nc" id="L87">		int currentColumn = 0;</span>
<span class="nc" id="L88">		int fret = 0;</span>
<span class="nc" id="L89">		int count = 0;</span>
<span class="nc" id="L90">		int measure = 0;</span>
<span class="nc" id="L91">		int line = 0;</span>
<span class="nc" id="L92">		int gate = 0;</span>
<span class="nc" id="L93">		double totalBeatPerMeasure = (1.0 * beat)/beatType;</span>
<span class="nc" id="L94">		double beatTypeNote = 1.0/beatType;</span>
<span class="nc" id="L95">		int div = getDivisions(beat);</span>
<span class="nc" id="L96">		double dash = 0; </span>
		char[] col;
<span class="nc" id="L98">		int[] fretarray = new int[stringAmount];</span>
<span class="nc" id="L99">		int[] linearray = new int[stringAmount];</span>
<span class="nc" id="L100">		char character = ' ';</span>
<span class="nc" id="L101">		int notesInColumn = 0;</span>
<span class="nc" id="L102">		char note = ' ';</span>
<span class="nc" id="L103">		int chordOctave = 0;</span>
		boolean doubleDigit;
		boolean doubleDigitColumn;
		boolean  chordDoubleDigitFlag;
		boolean chord;
<span class="nc" id="L108">		boolean hammerOn = false;</span>
<span class="nc" id="L109">		boolean hammerStart =false;</span>
<span class="nc" id="L110">		boolean hammerContinue = false;</span>
<span class="nc" id="L111">		boolean hammerDone = false;</span>
<span class="nc" id="L112">		int hammerLength = 0;</span>
<span class="nc" id="L113">		int hammerDuration = 0;</span>
<span class="nc" id="L114">		int hammerLocation = -1;</span>
<span class="nc" id="L115">		rest = 0.0;</span>
<span class="nc" id="L116">		double totalNote = 0.0;</span>

		
<span class="nc" id="L119">		String[] tune = new String[stringAmount];</span>
<span class="nc" id="L120">		int[] tuningOctave = new int[stringAmount];</span>
<span class="nc" id="L121">		boolean defaultTune = false;</span>
<span class="nc" id="L122">		boolean defaultOctave = false;</span>
<span class="nc" id="L123">        boolean[] sharp = new boolean[stringAmount];</span>
<span class="nc" id="L124">        boolean sharpnote = false;</span>
<span class="nc" id="L125">		boolean harmonic = false;</span>
<span class="nc" id="L126">		boolean[] hchord = new boolean[stringAmount];</span>
		/*adds the tuning of the strings to the tune array if the tuning is
		 * specified in the TAB, or the default if it isn't*/
<span class="nc bnc" id="L129" title="All 2 branches missed.">		for(int i = 0; i &lt; stringAmount; i++) {</span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">			if(input.get(i).get(0) != &quot;-&quot; &amp;&amp; input.get(i).get(0) != &quot;|&quot;) {</span>
<span class="nc" id="L131">				tune[i] = input.get(i).get(0);</span>
			}
		}
		
<span class="nc bnc" id="L135" title="All 2 branches missed.">		if(containsOnlyString(tune, &quot;&quot;)) {</span>
<span class="nc" id="L136">			tune = Tuning.getDefaultTuning(stringAmount);</span>
<span class="nc" id="L137">			defaultTune = true;</span>
		}
		
<span class="nc bnc" id="L140" title="All 2 branches missed.">		for(int i = 0; i &lt; stringAmount; i++) {</span>
<span class="nc bnc" id="L141" title="All 4 branches missed.">			if(input.get(i).get(1) != &quot;-&quot; &amp;&amp; input.get(i).get(1) != &quot;|&quot;) {</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">				if(input.get(i).get(1) == &quot;&quot;) {</span>
<span class="nc" id="L143">					tuningOctave[i] = -1;</span>
				}else {
<span class="nc" id="L145">					tuningOctave[i] = Integer.parseInt(input.get(i).get(1));</span>
				}

			}
		}
		
<span class="nc bnc" id="L151" title="All 2 branches missed.">		if(containsOnlyInt(tuningOctave, -1)) {</span>
<span class="nc" id="L152">			tuningOctave = Tuning.getDefaultTuningOctave(stringAmount);</span>
<span class="nc" id="L153">			defaultOctave = true;</span>
		}
<span class="nc" id="L155">		tunner = new Tuning(tune, stringAmount, tuningOctave);</span>

<span class="nc bnc" id="L157" title="All 4 branches missed.">		if(tunner.unSupportedOctave == true &amp;&amp; !defaultOctave)</span>
		{
<span class="nc" id="L159">			Main.myFrame.textInputContentPanel.errorText.setText(&quot;Octave Not Recognized&quot;);</span>
<span class="nc" id="L160">			return;</span>
		}
<span class="nc bnc" id="L162" title="All 4 branches missed.">		if(tunner.unSupportedTune == true &amp;&amp; !defaultTune)</span>
		{
<span class="nc" id="L164">			Main.myFrame.textInputContentPanel.errorText.setText(&quot;Tune Not Recognized&quot;);</span>
<span class="nc" id="L165">			return;</span>
		}

		//Create the file generator to generate the MusicXML file
<span class="nc" id="L169">		fileGen = new FileGenerator(&quot;&quot;);</span>
		
<span class="nc bnc" id="L171" title="All 2 branches missed.">		if(fileGen.failed) //Check if failed to save file to location</span>
<span class="nc" id="L172">			return;</span>
		
		//Calling the methods in the FileGenerator to build the MusicXML
		
		//Start the musicxml file
<span class="nc" id="L177">		fileGen.addInfo(misc.get(&quot;Title&quot;));</span>
		
		//Open part
<span class="nc" id="L180">		fileGen.openPart(1);</span>
		
		//Loop through the inputed columns
<span class="nc bnc" id="L183" title="All 2 branches missed.">		for(int i = 0; i &lt; columns.size(); i++)</span>
		{

<span class="nc" id="L186">			col = columns.get(i);</span>
<span class="nc" id="L187">			chordDoubleDigitFlag = false;</span>
<span class="nc" id="L188">			chord = false;</span>
<span class="nc" id="L189">			doubleDigitColumn = false;</span>

<span class="nc bnc" id="L191" title="All 2 branches missed.">			if(i &gt; 0) {</span>
<span class="nc" id="L192">				notesInColumn = 0;</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">				for (int s = 0; s &lt; col.length;s++) {</span>
<span class="nc" id="L194">					character = col[s];</span>
<span class="nc bnc" id="L195" title="All 4 branches missed.">					if (character != '-' &amp;&amp; character != '|') {</span>
<span class="nc" id="L196">						notesInColumn++;</span>
					}
				}
			}
<span class="nc bnc" id="L200" title="All 2 branches missed.">			if(notesInColumn &gt; 1) {</span>
<span class="nc" id="L201">				chord = true;</span>
			}
			// row For loop
<span class="nc bnc" id="L204" title="All 2 branches missed.">			for(int j = 0; j &lt; col.length; j++)</span>
			{
<span class="nc" id="L206">				doubleDigit = false;</span>
<span class="nc" id="L207">				character = col[j];</span>

				//This checks for double digits
<span class="nc bnc" id="L210" title="All 6 branches missed.">				if(i+1&lt;columns.size() &amp;&amp; Character.isDigit(columns.get(i)[j]) &amp;&amp; Character.isDigit(columns.get(i+1)[j]))</span>
				{
<span class="nc" id="L212">					doubleDigit = true;</span>
<span class="nc" id="L213">					doubleDigitColumn = true;</span>
				}


<span class="nc bnc" id="L217" title="All 12 branches missed.">				if( i+1&lt;columns.size()&amp;&amp; j&lt;col.length &amp;&amp; (columns.get(i+1)[j] == 'h' || (doubleDigit &amp;&amp;columns.get(i+2)[j]== 'h' ) ) &amp;&amp; !hammerOn){ // if same row, next col is an h then then begin hammer on</span>
																 // (i+1) only works for single digit frets
<span class="nc" id="L219">					int m = i;</span>
<span class="nc" id="L220">					char currentChar = columns.get(i)[j];</span>
<span class="nc" id="L221">					hammerLength++;</span>
<span class="nc" id="L222">					int lastHammerFret = 0;</span>
<span class="nc bnc" id="L223" title="All 4 branches missed.">					while(Character.isDigit(currentChar) || currentChar == 'h'){ // checks length of hammer on</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">						if(currentChar == 'h') hammerLength++;</span>
<span class="nc" id="L225">						lastHammerFret++;</span>
<span class="nc" id="L226">						m++;</span>
<span class="nc" id="L227">						currentChar =  columns.get(m)[j];</span>
<span class="nc" id="L228">						hammerLocation = j;</span>
					}
<span class="nc" id="L230">					hammerDuration = hamererOnDuration(columns.get(i+2)[j],i+lastHammerFret-1); // sets necessary flags to true</span>
<span class="nc" id="L231">					hammerOn = true;</span>
<span class="nc" id="L232">					hammerStart = true;</span>

<span class="nc" id="L234">				}</span>

<span class="nc bnc" id="L236" title="All 10 branches missed.">				else if(character != 'h' &amp;&amp; character != '-' &amp;&amp; character != '|' &amp;&amp; !hammerOn &amp;&amp;!chordDoubleDigitFlag) {</span>
<span class="nc" id="L237">					dash = 1;</span>
<span class="nc" id="L238">					int offset = 0;</span>
<span class="nc" id="L239">					char characterForward = columns.get(i+1)[j];</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">					if(Character.isDigit(characterForward)) {</span>
<span class="nc" id="L241">						chordDoubleDigitFlag = true;</span>
<span class="nc" id="L242">						offset++;</span>
					}
					boolean test;
<span class="nc bnc" id="L245" title="All 2 branches missed.">					for(int k = i+1+offset; k &lt; columns.size()-1; k++) {</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">						if(!containsOnlyChar(columns.get(k), '|')) {</span>
<span class="nc" id="L247">							test = containsOnlyChar(columns.get(k), '-');</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">							if(test) {</span>
<span class="nc" id="L249">								dash++;</span>
							}else
								break;
						}else
							break;
					}
					
					//System.out.println(&quot;Offset: &quot; + offset);					
				}

				//Finds if there is a new measure
<span class="nc bnc" id="L260" title="All 6 branches missed.">				if (character == '|' &amp;&amp; (i == 0 || columns.get(i-1)[j] != '|'))</span>
<span class="nc" id="L261">					count++;</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">				if (count == 6) {</span>
<span class="nc" id="L263">					measure++;</span>
<span class="nc" id="L264">					count = 0;					</span>
					
<span class="nc bnc" id="L266" title="All 2 branches missed.">					if(fileGen.measureOpen)</span>
<span class="nc" id="L267">						fileGen.closeMeasure();</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">					if(columns.size() &gt; currentColumn + 1) {</span>
						//System.out.println(&quot;measure &quot; + measure);
<span class="nc" id="L270">						fileGen.openMeasure(measure);</span>
						
<span class="nc bnc" id="L272" title="All 2 branches missed.">						if(measure == 1) {</span>
<span class="nc" id="L273">							fileGen.attributes(div, 0, beat, beatType, &quot;G&quot;, tune, tuningOctave);</span>
						}
					}
				}

				double beatNote;
<span class="nc bnc" id="L279" title="All 2 branches missed.">				if(hammerOn){</span>
<span class="nc" id="L280">					beatNote = beatNote((hammerDuration * totalBeatPerMeasure)/totalDash);/*beatNote((hammerDuration * beatTypeNote)/div);*/</span>
				}
<span class="nc" id="L282">				else {beatNote = beatNote((dash * totalBeatPerMeasure)/totalDash);/*beatNote((dash * beatTypeNote)/div)*/}</span>

				//Finds the string and fret of a note
<span class="nc" id="L285">				gate++;</span>
<span class="nc" id="L286">				line++;</span>
				
<span class="nc bnc" id="L288" title="All 4 branches missed.">				if (Character.isDigit(character) &amp;&amp; gate&gt;=7) {</span>
<span class="nc" id="L289">					fret = Character.getNumericValue(character);</span>
<span class="nc bnc" id="L290" title="All 4 branches missed.">					if (i-1&gt;0 &amp;&amp; columns.get(i-1)[j] == '[') {</span>
<span class="nc" id="L291">						harmonic = true;</span>
					}
<span class="nc bnc" id="L293" title="All 2 branches missed.">					if(doubleDigit) fret = (fret * 10) + Character.getNumericValue(columns.get(i+1)[j]);</span>
					//This checks for double digits
//					char characterForward = columns.get(i+1)[j];
//					if(Character.isDigit(columns.get(i)[j])&amp;&amp;Character.isDigit(characterForward))
//					{
//						doubleDigit = true;
//						fret = (fret * 10) + Character.getNumericValue(characterForward);
//					}
					
<span class="nc bnc" id="L302" title="All 2 branches missed.">					if(fret &lt; 0)</span>
					{
<span class="nc" id="L304">						System.out.println(&quot;Bad Char:(&quot; + character + &quot;)&quot;);</span>
<span class="nc" id="L305">						fret = 0;</span>
					}
<span class="nc bnc" id="L307" title="All 2 branches missed.">					if (!chord) {</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">						if (tunner.getNote(tune[line-1],fret).substring(tunner.getNote(tune[line-1], fret).length()-1,tunner.getNote(tune[line-1], fret).length()).equals(&quot;#&quot;)){</span>
<span class="nc" id="L309">							sharpnote = true;</span>
						}


<span class="nc" id="L313">						fileGen.addNote(line, fret, tunner.getNote(tune[line-1], fret).charAt(0), noteType(beatNote), getDuration(beatNote), tunner.getOctave(tune[line-1], fret), dot(beatNote),sharpnote, hammerStart,hammerContinue,hammerDone,harmonic);</span>
<span class="nc" id="L314">						harmonic = false;</span>
<span class="nc" id="L315">						System.out.println(&quot;&quot;);</span>
<span class="nc" id="L316">						System.out.println(&quot;Dash: &quot; + dash);</span>
<span class="nc" id="L317">						System.out.println(&quot;Duration: &quot; + getDuration(beatNote));</span>
<span class="nc" id="L318">						System.out.println(&quot;&quot;);</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">						if(rest &gt; 0) {</span>
<span class="nc" id="L320">							fileGen.addRest(getDuration(rest), noteType(rest));</span>
<span class="nc" id="L321">							System.out.println(&quot;&quot;);</span>
<span class="nc" id="L322">							System.out.println(&quot;RestDuration : &quot; + getDuration(rest));</span>
<span class="nc" id="L323">							System.out.println(&quot;RestType : &quot; + noteType(rest));</span>
<span class="nc" id="L324">							System.out.println(&quot;&quot;);</span>
<span class="nc" id="L325">							rest = 0.0;</span>
						}
							
<span class="nc bnc" id="L328" title="All 2 branches missed.">						if(hammerOn){</span>
<span class="nc" id="L329">							hammerLength--;</span>
						}
<span class="nc" id="L331">						sharpnote = false;</span>

<span class="nc bnc" id="L333" title="All 2 branches missed.">						if(hammerStart){ // indicates that we have past first note of hammer on</span>
<span class="nc" id="L334">							hammerStart = false;</span>
<span class="nc" id="L335">							hammerContinue = true;</span>
						}
<span class="nc bnc" id="L337" title="All 2 branches missed.">						if(hammerLength == 1){ // indicates that the next note is the end of the hammer on</span>
<span class="nc" id="L338">							hammerContinue = false;</span>
<span class="nc" id="L339">							hammerDone = true;</span>
						}
<span class="nc bnc" id="L341" title="All 2 branches missed.">						if (hammerLength == 0 ){ // indicates that the hammer on is over and back to regular scheduled programming</span>
<span class="nc" id="L342">							hammerDone = false;</span>
<span class="nc" id="L343">							hammerOn = false;</span>
<span class="nc" id="L344">							hammerDuration = 0;</span>
<span class="nc" id="L345">							hammerLength = 0;</span>
						}

					}
                    else {
<span class="nc bnc" id="L350" title="All 4 branches missed.">                    	if (i-1&gt;0 &amp;&amp; columns.get(i-1)[j] == '[') {</span>
<span class="nc" id="L351">    						hchord[j] = true;</span>
    					}
<span class="nc" id="L353">						linearray[j] = line;</span>
<span class="nc" id="L354">						fretarray[j] = fret;</span>
<span class="nc" id="L355">						note = tunner.getNote(tune[line-1], fret).charAt(0);</span>
<span class="nc" id="L356">						chordOctave = tunner.getOctave(tune[line-1], fret);</span>
<span class="nc" id="L357">						chords[j] = note;</span>
<span class="nc" id="L358">						chordsOctave[j] = chordOctave;</span>
<span class="nc" id="L359">						chordType = noteType(beatNote);</span>
<span class="nc" id="L360">						chordDot[j] = dot(beatNote);</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">						if (tunner.getNote(tune[line-1], fret).substring(tunner.getNote(tune[line-1], fret).length()-1,tunner.getNote(tune[line-1], fret).length()).equals(&quot;#&quot;)){</span>
<span class="nc" id="L362">							sharp[j] = true;</span>
						}
						else 
<span class="nc" id="L365">							sharp[j] = false;</span>
					}
				}
<span class="nc bnc" id="L368" title="All 2 branches missed.">				if (line == stringAmount) {</span>
<span class="nc" id="L369">					line = 0;</span>
				}	
			}
			
			
			//Chord
<span class="nc bnc" id="L375" title="All 2 branches missed.">			if (chord) {</span>
				double beatNote;
<span class="nc bnc" id="L377" title="All 2 branches missed.">				if(hammerOn){</span>
<span class="nc" id="L378">					beatNote = beatNote((hammerDuration * totalBeatPerMeasure)/totalDash);/*beatNote((hammerDuration * beatTypeNote)/div);*/</span>
<span class="nc" id="L379">					totalNote += beatNote;</span>
				}
				else {
<span class="nc" id="L382">					beatNote = beatNote((dash * totalBeatPerMeasure)/totalDash);/*beatNote((dash * beatTypeNote)/div)*/</span>
				}

<span class="nc" id="L385">				fileGen.addChord(chords,chordType, getDuration(beatNote), chordsOctave,linearray,fretarray, chordDot,sharp,hammerLocation,hammerStart,hammerContinue,hammerDone,hchord);</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">				if(rest &gt; 0) {</span>
<span class="nc" id="L387">					fileGen.addRest(getDuration(rest), noteType(rest));</span>
<span class="nc" id="L388">					System.out.println(&quot;&quot;);</span>
<span class="nc" id="L389">					System.out.println(&quot;RestDuration : &quot; + getDuration(rest));</span>
<span class="nc" id="L390">					System.out.println(&quot;RestType : &quot; + noteType(rest));</span>
<span class="nc" id="L391">					System.out.println(&quot;&quot;);</span>
<span class="nc" id="L392">					rest = 0.0;</span>
				}
<span class="nc" id="L394">				linearray = new int[stringAmount];</span>
<span class="nc" id="L395">				fretarray = new int[stringAmount];</span>
<span class="nc" id="L396">				chords = new char[stringAmount];</span>
<span class="nc" id="L397">				chordsOctave = new int[stringAmount];</span>
<span class="nc" id="L398">				chordDot = new int[stringAmount];</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">				if(hammerOn){</span>
<span class="nc" id="L400">					hammerLength--;</span>
				}
<span class="nc bnc" id="L402" title="All 2 branches missed.">				if(hammerStart){ // indicates that we have past first note of hammer on</span>
<span class="nc" id="L403">					hammerStart = false;</span>
<span class="nc" id="L404">					hammerContinue = true;</span>
				}
<span class="nc bnc" id="L406" title="All 2 branches missed.">				if(hammerLength == 1){ // indicates that the next note is the end of the hammer on</span>
<span class="nc" id="L407">					hammerContinue = false;</span>
<span class="nc" id="L408">					hammerDone = true;</span>
				}
<span class="nc bnc" id="L410" title="All 2 branches missed.">				if (hammerLength == 0 ){ // indicates that the hammer on is over and back to regular scheduled programming</span>
<span class="nc" id="L411">					hammerDone = false;</span>
<span class="nc" id="L412">					hammerOn = false;</span>
<span class="nc" id="L413">					hammerDuration = 0;</span>
<span class="nc" id="L414">					hammerLength = 0;</span>
				}
			}
			
<span class="nc bnc" id="L418" title="All 2 branches missed.">			if(doubleDigitColumn) { //Skip next line if double digit</span>
<span class="nc" id="L419">				i++;</span>
<span class="nc" id="L420">				currentColumn++;</span>
			}
			
<span class="nc" id="L423">			currentColumn++;</span>
		}
		
		//End the musicxml file
<span class="nc bnc" id="L427" title="All 2 branches missed.">		if(fileGen.measureOpen)</span>
<span class="nc" id="L428">			fileGen.closeMeasure();</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">		if(fileGen.partOpen)</span>
<span class="nc" id="L430">			fileGen.closePart();</span>
<span class="nc" id="L431">		fileGen.end();</span>
		
<span class="nc" id="L433">		new SuccessPopUp(Main.myFrame, FileGenerator.filepath);</span>
<span class="nc" id="L434">	}</span>
	
	private boolean containsOnlyChar(char[] cs, char o) {
<span class="nc" id="L437">		boolean output = true;</span>
		
<span class="nc bnc" id="L439" title="All 2 branches missed.">		for(Object t : cs) {</span>
<span class="nc bnc" id="L440" title="All 12 branches missed.">			output = (output &amp;&amp; t.equals(o)) || (output &amp;&amp; t.equals('[')) || (output &amp;&amp; t.equals(']'));</span>
		}
		
<span class="nc" id="L443">		return output;</span>
	}

	private int hamererOnDuration(char afterhammer, int i){
<span class="nc bnc" id="L447" title="All 4 branches missed.">		if( afterhammer!= '-' &amp;&amp; afterhammer != '|') {</span>
<span class="nc" id="L448">			int dash = 1;</span>
			boolean test;
<span class="nc bnc" id="L450" title="All 2 branches missed.">			for(int k = i+1; k &lt; columns.size()-1; k++) {</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">				if(!containsOnlyChar(columns.get(k), '|'))</span>
				{
<span class="nc" id="L453">					test = containsOnlyChar(columns.get(k), '-');</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">					if(test) {</span>
<span class="nc" id="L455">						dash++;</span>
					}else {
						break;
					}
				}
				else
					break;
			}
<span class="nc" id="L463">			return dash;</span>
		}
<span class="nc" id="L465">		return 1;</span>
	}

	private boolean containsOnlyInt(int[] cs, int o) {
<span class="nc" id="L469">		boolean output = true;</span>
		
<span class="nc bnc" id="L471" title="All 2 branches missed.">		for(Object t : cs) {</span>
<span class="nc bnc" id="L472" title="All 4 branches missed.">			output = output &amp;&amp; t.equals(o) ;</span>
		}
		
<span class="nc" id="L475">		return output;</span>
	}
	
	private boolean containsOnlyString(String[] cs, String o) {
<span class="nc" id="L479">		boolean output = true;</span>
		
<span class="nc bnc" id="L481" title="All 2 branches missed.">		for(Object t : cs) {</span>
<span class="nc bnc" id="L482" title="All 4 branches missed.">			output = output &amp;&amp; t.equals(o) ;</span>
		}
		
<span class="nc" id="L485">		return output;</span>
	}
	
	private int dot(double beatNote) {
<span class="nc" id="L489">		System.out.println(&quot;&quot;);</span>
<span class="nc" id="L490">		System.out.println(&quot;DotBeatNote: &quot; + beatNote);</span>
<span class="nc" id="L491">		int output = 0;</span>
<span class="nc" id="L492">		double check = 0.0;</span>
<span class="nc" id="L493">		double check2 = 0.0;</span>
		double temp;
<span class="nc" id="L495">		double div = 2.0;</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">		for(double i = 2.0; i &gt; 0.0; i = i/2.0) {</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">			if(beatNote &gt;= i) {</span>
<span class="nc" id="L498">				check = i;</span>
<span class="nc" id="L499">				break;</span>
			}
		}
		
<span class="nc" id="L503">		System.out.println(&quot;DotCheck: &quot; + check);</span>
<span class="nc" id="L504">		temp = check;</span>
<span class="nc" id="L505">		check2 = check;</span>
		
		while(true) {
<span class="nc" id="L508">			check = check + temp/div;</span>
<span class="nc bnc" id="L509" title="All 4 branches missed.">			if(check2 &lt; beatNote &amp;&amp; beatNote &gt; check) {</span>
<span class="nc" id="L510">				System.out.println(check2 + &quot; &lt; &quot; + beatNote + &quot; &gt; &quot; + check);</span>
<span class="nc" id="L511">				output++;</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">			}else if(beatNote == check) {</span>
<span class="nc" id="L513">				System.out.println(beatNote + &quot; == &quot; + check);</span>
<span class="nc" id="L514">				output++;</span>
<span class="nc" id="L515">				break;</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">			}else if(beatNote &lt; check) {</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">				if(check - beatNote &lt; check - check2) {</span>
					//add the rest here
<span class="nc" id="L519">					rest = beatNote(beatNote - check2);</span>
<span class="nc" id="L520">					System.out.println(&quot;DotRest: &quot; + rest);</span>
				}else {
					break;
				}
			}
<span class="nc" id="L525">			check2 = check2 + temp/div;</span>
<span class="nc" id="L526">			div *= 2;</span>
			}
<span class="nc" id="L528">		System.out.println(&quot;&quot;);</span>
<span class="nc" id="L529">		return output;</span>
		}

	
	private double beatNote(double b) {
<span class="nc" id="L534">		double output = 0.0;</span>
		
<span class="nc" id="L536">		System.out.println(&quot;BeatNote: &quot; + b);</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">		if(b &gt;= 1.0/256) {</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">			if(b &gt;= 2.0) {</span>
<span class="nc" id="L539">				output = 2.0;</span>
<span class="nc" id="L540">				output += beatNote(b - output);</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">			}else if(b &gt;= 1.0) {</span>
<span class="nc" id="L542">				output = 1.0;</span>
<span class="nc" id="L543">				output += beatNote(b - output);</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">			}else if(b &gt;= 1.0/2.0) {</span>
<span class="nc" id="L545">				output = 1.0/2;</span>
<span class="nc" id="L546">				output += beatNote(b - output);</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">			}else if(b &gt;= 1.0/4.0) {</span>
<span class="nc" id="L548">				output = 1.0/4;</span>
<span class="nc" id="L549">				output += beatNote(b - output);</span>
<span class="nc bnc" id="L550" title="All 2 branches missed.">			}else if(b  &gt;= 1.0/8.0) {</span>
<span class="nc" id="L551">				output = 1.0/8;</span>
<span class="nc" id="L552">				output += beatNote(b - output);</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">			}else if(b &lt; 1.0/8.0) {</span>
<span class="nc" id="L554">				double div = ((1.0/8.0)/b);</span>
<span class="nc" id="L555">				int maxIndex = 0;</span>
<span class="nc" id="L556">				double power = 0.0;</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">				if(div % 2 != 0.0) {</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">					while(div % 2 != 0.0) {</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">						if(div &lt; Math.pow(2.0, power)) {</span>
<span class="nc" id="L560">							div = (int) Math.pow(2, power);</span>
						}else {
<span class="nc" id="L562">							power += 1.0;</span>
						}
					}
				}
<span class="nc" id="L566">				System.out.println(&quot;Power: &quot; + power);</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">				while(div != 1) {</span>
<span class="nc" id="L568">					div = div/2;</span>
<span class="nc" id="L569">					maxIndex++;</span>
				}
<span class="nc" id="L571">				int temp = (int)(Math.pow(2, maxIndex) * 8);</span>
<span class="nc" id="L572">				output = 1.0/temp;</span>
<span class="nc" id="L573">				System.out.println(&quot;Temp: &quot; + temp);</span>
<span class="nc" id="L574">				output += beatNote(b - output);</span>
			}
		}
		
<span class="nc" id="L578">		System.out.println(&quot;BeatNoteOut: &quot; + output);</span>
		
<span class="nc" id="L580">		return output;</span>
		}
	
	protected static String noteType(double beatNote) {
<span class="fc" id="L584">		String output = &quot;&quot;;</span>
		
<span class="fc bfc" id="L586" title="All 2 branches covered.">		if(beatNote &gt;= 1.0) {</span>
<span class="fc" id="L587">			output = &quot;whole&quot;;</span>
<span class="fc bfc" id="L588" title="All 2 branches covered.">		}else if(beatNote &gt;= 1.0/2.0) {</span>
<span class="fc" id="L589">			output = &quot;half&quot;;</span>
<span class="fc bfc" id="L590" title="All 2 branches covered.">		}else if(beatNote &gt;= 1.0/4.0) {</span>
<span class="fc" id="L591">			output = &quot;quarter&quot;;</span>
<span class="fc bfc" id="L592" title="All 2 branches covered.">		}else if(beatNote  &gt;= 1.0/8.0) {</span>
<span class="fc" id="L593">			output = &quot;eighth&quot;;</span>
<span class="pc bpc" id="L594" title="1 of 2 branches missed.">		}else if(beatNote &lt; 1.0/8.0) {</span>
<span class="fc" id="L595">			int div = (int) ((1.0/8.0)/beatNote);</span>
<span class="fc" id="L596">			int maxIndex = 0;</span>
<span class="fc" id="L597">			double power = 0.0;</span>
<span class="pc bpc" id="L598" title="1 of 2 branches missed.">			if(div % 2 != 0) {</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">				while(div % 2 != 0) {</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">					if(div &lt; Math.pow(2.0, power)) {</span>
<span class="nc" id="L601">						div = (int) Math.pow(2, power);</span>
					}else {
<span class="nc" id="L603">						power = power + 1.0;</span>
					}
				}
			}
<span class="fc bfc" id="L607" title="All 2 branches covered.">			while(div != 1) {</span>
<span class="fc" id="L608">				div = div/2;</span>
<span class="fc" id="L609">				maxIndex++;</span>
			}
<span class="fc" id="L611">			int temp = (int)(Math.pow(2, maxIndex) * 8);</span>
<span class="fc" id="L612">			output = output + temp;</span>
<span class="fc" id="L613">			int lastTwo = Integer.parseInt(output.substring(output.length()-2));</span>
<span class="pc bpc" id="L614" title="1 of 2 branches missed.">			if(output.charAt(output.length()-1) == '1') {</span>
<span class="nc" id="L615">				output = output + &quot;st&quot;;</span>
<span class="pc bpc" id="L616" title="1 of 4 branches missed.">			}else if(11 &lt;= lastTwo &amp;&amp; lastTwo &lt;= 19) {</span>
<span class="fc" id="L617">				output = output + &quot;th&quot;;</span>
<span class="fc bfc" id="L618" title="All 2 branches covered.">			}else if(output.charAt(output.length()-1) == '2') {</span>
<span class="fc" id="L619">				output = output + &quot;nd&quot;;</span>
<span class="pc bpc" id="L620" title="1 of 2 branches missed.">			}else if(output.charAt(output.length()-1) == '3') {</span>
<span class="nc" id="L621">				output = output + &quot;rd&quot;;</span>
			}else {
<span class="fc" id="L623">				output = output + &quot;th&quot;;</span>
			}
		}
<span class="fc" id="L626">		return output;</span>
	}
	
	private int getDuration(double noteType) {
<span class="nc" id="L630">		double output = 0;</span>
<span class="nc" id="L631">		double div = getDivisions(beat);</span>
<span class="nc" id="L632">		double beatTypeNote = 1.0/beatType;</span>
<span class="nc" id="L633">		output = (noteType * div)/beatTypeNote;</span>
<span class="nc" id="L634">		System.out.println(&quot;DurationOutput: &quot; + output);</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">		if(output%0.5 == 0)</span>
<span class="nc" id="L636">			return (int)output;</span>
		else
<span class="nc" id="L638">			return (int)Math.round(output);</span>
	}
	
	private double noteFromDash(int d) {
<span class="nc" id="L642">		double output = 0.0;</span>
		
<span class="nc" id="L644">		output = ((1.0 * beat/beatType)*d)/totalDash;</span>
		
<span class="nc" id="L646">		return output;</span>
	}
	
	private int getDivisions(int beatSig) {
<span class="nc" id="L650">		int hyfenNumber = 0;</span>
<span class="nc" id="L651">		int boundary = 0;</span>
<span class="nc" id="L652">		int value = 0;</span>
		//System.out.println(&quot;&quot;);
		
<span class="nc bnc" id="L655" title="All 2 branches missed.">		for(int i = 0; i &lt; columns.size(); i++) {</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">			if(containsOnlyChar(columns.get(i), '-')) {</span>
				//System.out.println(&quot;Dash&quot;);
			}
<span class="nc bnc" id="L659" title="All 2 branches missed.">			if(containsOnlyChar(columns.get(i), '|')) {</span>
<span class="nc" id="L660">				boundary++;</span>
				//System.out.println(&quot;Boundary&quot;);
			}
<span class="nc bnc" id="L663" title="All 2 branches missed.">			if(boundary == 2) {</span>
				//System.out.println(&quot;Break&quot;);
<span class="nc" id="L665">				break;</span>
			}
<span class="nc bnc" id="L667" title="All 2 branches missed.">			if(!containsOnlyChar(columns.get(i), '-')) {</span>
<span class="nc" id="L668">				value++;</span>
				//System.out.println(&quot;Value: &quot; + value);
			}
<span class="nc bnc" id="L671" title="All 4 branches missed.">			if(boundary == 1 &amp;&amp; value &gt; 1) {				</span>
<span class="nc" id="L672">				hyfenNumber++;</span>
				//System.out.println(&quot;Hyfen Increase: &quot; + hyfenNumber);
			}
		}
		
		/*
		for(int i=0;i&lt; columns.size();i++) {
			
			if(columns.get(i)[0] == '|'){
				boundary++;
			}
			if (boundary == 2) {
				break;
			}
			
			if(columns.get(i)[0] == '-' || columns.get(i)[0] == 'h') {
				hyfenNumber++;
				System.out.println(&quot;- || h&quot;);
			}
			else {
				if(i==0) {
				
				}
				else if(columns.get(i-1)[0] == 'h') {
					hyfenNumber++;
					System.out.println(&quot;h&quot;);
				}
				else if(columns.get(i-1)[0] != '-') {
					
				}
				else {
					hyfenNumber++;
					System.out.println(&quot;Else&quot;);
				}
		}
			}*/
		//System.out.println(&quot;&quot;);
<span class="nc" id="L709">		totalDash = hyfenNumber;</span>
<span class="nc" id="L710">		double beatNote = 1.0/beatType;</span>
<span class="nc" id="L711">		double bSig  = 1.0 * beatSig;</span>
<span class="nc" id="L712">		double totalBeatPerMeasure = bSig/beatType;</span>
<span class="nc" id="L713">		double division = (hyfenNumber * beatNote)/totalBeatPerMeasure;</span>
		//System.out.println(&quot;TBM: &quot; + totalBeatPerMeasure);
		//System.out.println(&quot;hyfen number is &quot;+hyfenNumber);
		//System.out.println(&quot;Division: &quot; + division);

<span class="nc bnc" id="L718" title="All 2 branches missed.">		if(division%0.5 == 0)</span>
<span class="nc" id="L719">            return (int)division;</span>
        else
<span class="nc" id="L721">            return (int)Math.round(division);</span>
	}


	static void addTitle(String title){
<span class="fc" id="L726">		misc.put(&quot;Title&quot;,title);</span>
<span class="fc" id="L727">	}</span>
	
	static void addTabType(String tabType){
<span class="fc" id="L730">		misc.put(&quot;TabType&quot;,tabType);</span>
<span class="fc" id="L731">	}</span>
	
	static void addTime(String timeSig){
<span class="fc" id="L734">		misc.put(&quot;TimeSig&quot;,timeSig);</span>
<span class="fc" id="L735">		System.out.println(&quot;TimeSig: &quot; + timeSig);</span>
<span class="fc" id="L736">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>