<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Parser.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TAB2MXL</a> &gt; <a href="index.source.html" class="el_package">tab2mxl</a> &gt; <span class="el_source">Parser.java</span></div><h1>Parser.java</h1><pre class="source lang-java linenums">package tab2mxl;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import gui_panels.TextInputContentPanel;
import gui_popups.SuccessPopUp;

public class Parser {

	int instrument;
	int stringAmount;
	int tabLineAmount;
	private int beat;
	private int beatType;
	private ArrayList&lt;char[]&gt; columns;
	public static  Map&lt;String,String&gt; misc;
	private Tuning tunner;
	private FileGenerator fileGen;
	private double rest;
	private int totalDash;
	
	//@SuppressWarnings(&quot;unused&quot;)
<span class="fc" id="L25">	Parser(ArrayList&lt;ArrayList&lt;String&gt;&gt; input, int in ,String path) {</span>
<span class="fc" id="L26">		stringAmount = 0;</span>
<span class="fc" id="L27">		tabLineAmount = 1;</span>
<span class="fc" id="L28">		misc = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L29">		instrument = in;</span>
		
<span class="fc" id="L31">		addTitle(TextInputContentPanel.getTitle());</span>
<span class="fc" id="L32">		addInstrument(TextInputContentPanel.getInstrument());</span>
<span class="fc" id="L33">		addTime(TextInputContentPanel.getTimeSig());</span>
		
		//set the time signature to default if the inputed time signature isn't in the right format
<span class="pc bpc" id="L36" title="1 of 2 branches missed.">		if(misc.get(&quot;TimeSig&quot;) == &quot;&quot;) {</span>
<span class="nc" id="L37">			beat = 4;</span>
<span class="nc" id="L38">			beatType = 4;</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">		}else if(misc.get(&quot;TimeSig&quot;).indexOf('/') == -1) {</span>
<span class="nc" id="L40">			beat = 4;</span>
<span class="nc" id="L41">			beatType = 4;</span>
<span class="pc bpc" id="L42" title="1 of 2 branches missed.">		}else if(misc.get(&quot;TimeSig&quot;).charAt(0) == '/') {</span>
<span class="nc" id="L43">			beat = 4;</span>
<span class="nc" id="L44">			beatType = 4;</span>
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">		}else if(misc.get(&quot;TimeSig&quot;).charAt(misc.get(&quot;TimeSig&quot;).length()-1) == '/') {</span>
<span class="nc" id="L46">			beat  = 4;</span>
<span class="nc" id="L47">			beatType = 4;</span>
			//set the time signature to default if the inputed time signature isn't in the right format
		}else {
			//get the beat and beat-type from the information given in the time signature
			try{
<span class="fc" id="L52">				beat = Integer.parseInt(misc.get(&quot;TimeSig&quot;).substring(0, misc.get(&quot;TimeSig&quot;).indexOf('/')));</span>
<span class="fc" id="L53">				beatType = Integer.parseInt(misc.get(&quot;TimeSig&quot;).substring(misc.get(&quot;TimeSig&quot;).indexOf('/')+1));</span>
<span class="nc" id="L54">			}catch(NumberFormatException e) {</span>
<span class="nc" id="L55">				beat = 4;</span>
<span class="nc" id="L56">				beatType = 4;</span>
<span class="fc" id="L57">			}</span>
		}
//		System.out.println(&quot;beat: &quot; + beat);
//		System.out.println(&quot;beatType: &quot; + beatType);
		
<span class="fc bfc" id="L62" title="All 2 branches covered.">		for(int i = 0; i &lt; input.size(); i++) {			</span>
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">			if(input.get(i).size() &lt; 2)</span>
<span class="nc" id="L64">				break;</span>
<span class="fc" id="L65">			stringAmount++;</span>
		}
		
<span class="fc bfc" id="L68" title="All 2 branches covered.">		for(int i = 0; i &lt; input.size(); i++) {</span>
<span class="pc bpc" id="L69" title="5 of 6 branches missed.">			if(input.get(i).size() &lt; 2 &amp;&amp; input.get(i-1).size() &gt; 2 &amp;&amp; i != input.size())</span>
<span class="nc" id="L70">				tabLineAmount++;</span>
		}
				
		//Transpose columns to rows (do you mean rows to col?)
<span class="fc" id="L74">		columns = new ArrayList&lt;char[]&gt;();</span>
		
<span class="fc bfc" id="L76" title="All 2 branches covered.">		for(int layer = 0; layer &lt; tabLineAmount; layer++) {</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">			for(int i = 2; i &lt; input.get((layer * stringAmount) + layer).size(); i++) {</span>
<span class="fc" id="L78">				columns.add(new char[stringAmount]);</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">				for(int l = 0; l &lt; stringAmount; l++) {</span>
<span class="fc" id="L80">					columns.get(columns.size()-1)[l] = input.get(l + (layer * stringAmount) + layer).get(i).charAt(0);</span>
				}
			}
		}

<span class="fc" id="L85">		char[] chords = new char[stringAmount];</span>
<span class="fc" id="L86">		int[] chordsOctave = new int[stringAmount];</span>
<span class="fc" id="L87">		String chordType= &quot;&quot;;</span>
<span class="fc" id="L88">		int[] chordDot = new int[stringAmount];		</span>
<span class="fc" id="L89">		int currentColumn = 0;</span>
<span class="fc" id="L90">		int fret = 0;</span>
<span class="fc" id="L91">		int count = 0;</span>
<span class="fc" id="L92">		int measure = 0;</span>
<span class="fc" id="L93">		int line = 0;</span>
<span class="fc" id="L94">		int gate = 0;</span>
<span class="fc" id="L95">		double totalBeatPerMeasure = (1.0 * beat)/beatType;</span>
<span class="fc" id="L96">		double beatTypeNote = 1.0/beatType;</span>
<span class="fc" id="L97">		int div = getDivisions(beat);</span>
<span class="fc" id="L98">		double dash = 0; </span>
		char[] col;
<span class="fc" id="L100">		int[] fretarray = new int[stringAmount];</span>
<span class="fc" id="L101">		int[] linearray = new int[stringAmount];</span>
<span class="fc" id="L102">		char character = ' ';</span>
<span class="fc" id="L103">		int notesInColumn = 0;</span>
<span class="fc" id="L104">		char note = ' ';</span>
<span class="fc" id="L105">		int chordOctave = 0;</span>
		boolean doubleDigit;
		boolean doubleDigitColumn;
		boolean  chordDoubleDigitFlag;
		boolean chord;
<span class="fc" id="L110">		boolean hammerOn = false;</span>
<span class="fc" id="L111">		boolean hammerStart =false;</span>
<span class="fc" id="L112">		boolean hammerContinue = false;</span>
<span class="fc" id="L113">		boolean hammerDone = false;</span>
<span class="fc" id="L114">		int hammerLength = 0;</span>
<span class="fc" id="L115">		int hammerDuration = 0;</span>
<span class="fc" id="L116">		int hammerLocation = -1;</span>
<span class="fc" id="L117">		rest = 0.0;</span>
<span class="fc" id="L118">		double totalNote = 0.0;</span>

<span class="fc" id="L120">		String[] tune = new String[stringAmount];</span>
<span class="fc" id="L121">		int[] tuningOctave = new int[stringAmount];</span>
<span class="fc" id="L122">		boolean defaultTune = false;</span>
<span class="fc" id="L123">		boolean defaultOctave = false;</span>
<span class="fc" id="L124">        boolean[] sharp = new boolean[stringAmount];</span>
<span class="fc" id="L125">        boolean sharpnote = false;</span>
<span class="fc" id="L126">		boolean harmonic = false;</span>
<span class="fc" id="L127">		boolean[] hchord = new boolean[stringAmount];</span>
		/*adds the tuning of the strings to the tune array if the tuning is
		 * specified in the TAB, or the default if it isn't*/
<span class="fc bfc" id="L130" title="All 2 branches covered.">		for(int i = 0; i &lt; stringAmount; i++) {</span>
<span class="pc bpc" id="L131" title="2 of 4 branches missed.">			if(input.get(i).get(0) != &quot;-&quot; &amp;&amp; input.get(i).get(0) != &quot;|&quot;) {</span>
<span class="fc" id="L132">				tune[i] = input.get(i).get(0);</span>
			}
		}
		
<span class="fc bfc" id="L136" title="All 2 branches covered.">		if(containsOnlyString(tune, &quot;&quot;)) {</span>
<span class="fc" id="L137">			tune = Tuning.getDefaultTuning(stringAmount);</span>
<span class="fc" id="L138">			defaultTune = true;</span>
		}
		
<span class="fc bfc" id="L141" title="All 2 branches covered.">		for(int i = 0; i &lt; stringAmount; i++) {</span>
<span class="pc bpc" id="L142" title="2 of 4 branches missed.">			if(input.get(i).get(1) != &quot;-&quot; &amp;&amp; input.get(i).get(1) != &quot;|&quot;) {</span>
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">				if(input.get(i).get(1) == &quot;&quot;) {</span>
<span class="fc" id="L144">					tuningOctave[i] = -1;</span>
				}else {
<span class="nc" id="L146">					tuningOctave[i] = Integer.parseInt(input.get(i).get(1));</span>
				}

			}
		}
		
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">		if(containsOnlyInt(tuningOctave, -1)) {</span>
<span class="fc" id="L153">			tuningOctave = Tuning.getDefaultTuningOctave(stringAmount, instrument);</span>
<span class="fc" id="L154">			defaultOctave = true;</span>
		}
<span class="fc" id="L156">		tunner = new Tuning(tune, stringAmount, tuningOctave);</span>

<span class="pc bpc" id="L158" title="3 of 4 branches missed.">		if(tunner.unSupportedOctave == true &amp;&amp; !defaultOctave)</span>
		{
<span class="nc" id="L160">			Main.myFrame.textInputContentPanel.errorText.setText(&quot;Octave Not Recognized&quot;);</span>
<span class="nc" id="L161">			return;</span>
		}
<span class="pc bpc" id="L163" title="3 of 4 branches missed.">		if(tunner.unSupportedTune == true &amp;&amp; !defaultTune)</span>
		{
<span class="nc" id="L165">			Main.myFrame.textInputContentPanel.errorText.setText(&quot;Tune Not Recognized&quot;);</span>
<span class="nc" id="L166">			return;</span>
		}

		//Create the file generator to generate the MusicXML file
<span class="fc" id="L170">		fileGen = new FileGenerator(path);</span>
		
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">		if(fileGen.failed) //Check if failed to save file to location</span>
<span class="nc" id="L173">			return;</span>
		
		//Calling the methods in the FileGenerator to build the MusicXML
		
		//Start the musicxml file
<span class="fc" id="L178">		fileGen.addInfo(misc.get(&quot;Title&quot;), misc.get(&quot;Instrument&quot;));</span>
		
		//Open part
<span class="fc" id="L181">		fileGen.openPart(1);</span>
		
		//Loop through the inputed columns
<span class="fc bfc" id="L184" title="All 2 branches covered.">		for(int i = 0; i &lt; columns.size(); i++)</span>
		{

<span class="fc" id="L187">			col = columns.get(i);</span>
<span class="fc" id="L188">			chordDoubleDigitFlag = false;</span>
<span class="fc" id="L189">			chord = false;</span>
<span class="fc" id="L190">			doubleDigitColumn = false;</span>

<span class="fc bfc" id="L192" title="All 2 branches covered.">			if(i &gt; 0) {</span>
<span class="fc" id="L193">				notesInColumn = 0;</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">				for (int s = 0; s &lt; col.length;s++) {</span>
<span class="fc" id="L195">					character = col[s];</span>
<span class="fc bfc" id="L196" title="All 4 branches covered.">					if (character != '-' &amp;&amp; character != '|') {</span>
<span class="fc" id="L197">						notesInColumn++;</span>
					}
				}
			}
<span class="fc bfc" id="L201" title="All 2 branches covered.">			if(notesInColumn &gt; 1) {</span>
<span class="fc" id="L202">				chord = true;</span>
			}
			// row For loop
<span class="fc bfc" id="L205" title="All 2 branches covered.">			for(int j = 0; j &lt; col.length; j++)</span>
			{
<span class="fc" id="L207">				doubleDigit = false;</span>
<span class="fc" id="L208">				character = col[j];</span>

				//This checks for double digits
<span class="pc bpc" id="L211" title="1 of 6 branches missed.">				if(i+1&lt;columns.size() &amp;&amp; Character.isDigit(columns.get(i)[j]) &amp;&amp; Character.isDigit(columns.get(i+1)[j]))</span>
				{
<span class="nc" id="L213">					doubleDigit = true;</span>
<span class="nc" id="L214">					doubleDigitColumn = true;</span>
				}


<span class="pc bpc" id="L218" title="4 of 12 branches missed.">				if( i+1&lt;columns.size()&amp;&amp; j&lt;col.length &amp;&amp; (columns.get(i+1)[j] == 'h' || (doubleDigit &amp;&amp;columns.get(i+2)[j]== 'h' ) ) &amp;&amp; !hammerOn){ // if same row, next col is an h then then begin hammer on</span>
																 // (i+1) only works for single digit frets
<span class="fc" id="L220">					int m = i;</span>
<span class="fc" id="L221">					char currentChar = columns.get(i)[j];</span>
<span class="fc" id="L222">					hammerLength++;</span>
<span class="fc" id="L223">					int lastHammerFret = 0;</span>
<span class="fc bfc" id="L224" title="All 4 branches covered.">					while(Character.isDigit(currentChar) || currentChar == 'h'){ // checks length of hammer on</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">						if(currentChar == 'h') hammerLength++;</span>
<span class="fc" id="L226">						lastHammerFret++;</span>
<span class="fc" id="L227">						m++;</span>
<span class="fc" id="L228">						currentChar =  columns.get(m)[j];</span>
<span class="fc" id="L229">						hammerLocation = j;</span>
					}
<span class="fc" id="L231">					hammerDuration = hamererOnDuration(columns.get(i+2)[j],i+lastHammerFret-1); // sets necessary flags to true</span>
<span class="fc" id="L232">					hammerOn = true;</span>
<span class="fc" id="L233">					hammerStart = true;</span>

<span class="fc" id="L235">				}</span>

<span class="pc bpc" id="L237" title="1 of 10 branches missed.">				else if(character != 'h' &amp;&amp; character != '-' &amp;&amp; character != '|' &amp;&amp; !hammerOn &amp;&amp;!chordDoubleDigitFlag) {</span>
<span class="fc" id="L238">					dash = 1;</span>
<span class="fc" id="L239">					int offset = 0;</span>
<span class="fc" id="L240">					char characterForward = columns.get(i+1)[j];</span>
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">					if(Character.isDigit(characterForward)) {</span>
<span class="nc" id="L242">						chordDoubleDigitFlag = true;</span>
<span class="nc" id="L243">						offset++;</span>
					}
					boolean test;
<span class="fc bfc" id="L246" title="All 2 branches covered.">					for(int k = i+1+offset; k &lt; columns.size()-1; k++) {</span>
<span class="fc bfc" id="L247" title="All 2 branches covered.">						if(!containsOnlyChar(columns.get(k), '|')) {</span>
<span class="fc" id="L248">							test = containsOnlyChar(columns.get(k), '-');</span>
<span class="fc bfc" id="L249" title="All 2 branches covered.">							if(test) {</span>
<span class="fc" id="L250">								dash++;</span>
							}else
								break;
						}else
							break;
					}
					
					//System.out.println(&quot;Offset: &quot; + offset);					
				}

				//Finds if there is a new measure
<span class="pc bpc" id="L261" title="1 of 6 branches missed.">				if (character == '|' &amp;&amp; (i == 0 || columns.get(i-1)[j] != '|'))</span>
<span class="fc" id="L262">					count++;</span>
<span class="fc bfc" id="L263" title="All 2 branches covered.">				if (count == 6) {</span>
<span class="fc" id="L264">					measure++;</span>
<span class="fc" id="L265">					count = 0;					</span>
					
<span class="fc bfc" id="L267" title="All 2 branches covered.">					if(fileGen.measureOpen)</span>
<span class="fc" id="L268">						fileGen.closeMeasure();</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">					if(columns.size() &gt; currentColumn + 1) {</span>
						//System.out.println(&quot;measure &quot; + measure);
<span class="fc" id="L271">						fileGen.openMeasure(measure);</span>
						
<span class="fc bfc" id="L273" title="All 2 branches covered.">						if(measure == 1) {</span>
<span class="fc" id="L274">							fileGen.attributes(div, 0, beat, beatType, &quot;G&quot;, tune, tuningOctave);</span>
						}
					}
				}

				double beatNote;
<span class="fc bfc" id="L280" title="All 2 branches covered.">				if(hammerOn){</span>
<span class="fc" id="L281">					beatNote = beatNote((hammerDuration * totalBeatPerMeasure)/totalDash);/*beatNote((hammerDuration * beatTypeNote)/div);*/</span>
				}
<span class="fc" id="L283">				else {beatNote = beatNote((dash * totalBeatPerMeasure)/totalDash);/*beatNote((dash * beatTypeNote)/div)*/}</span>

				//Finds the string and fret of a note
<span class="fc" id="L286">				gate++;</span>
<span class="fc" id="L287">				line++;</span>
				
<span class="pc bpc" id="L289" title="1 of 4 branches missed.">				if (Character.isDigit(character) &amp;&amp; gate&gt;=7) {</span>
<span class="fc" id="L290">					fret = Character.getNumericValue(character);</span>
<span class="pc bpc" id="L291" title="2 of 4 branches missed.">					if (i-1&gt;0 &amp;&amp; columns.get(i-1)[j] == '[') {</span>
<span class="nc" id="L292">						harmonic = true;</span>
					}
<span class="pc bpc" id="L294" title="1 of 2 branches missed.">					if(doubleDigit) fret = (fret * 10) + Character.getNumericValue(columns.get(i+1)[j]);</span>
					//This checks for double digits
//					char characterForward = columns.get(i+1)[j];
//					if(Character.isDigit(columns.get(i)[j])&amp;&amp;Character.isDigit(characterForward))
//					{
//						doubleDigit = true;
//						fret = (fret * 10) + Character.getNumericValue(characterForward);
//					}
					
<span class="pc bpc" id="L303" title="1 of 2 branches missed.">					if(fret &lt; 0)</span>
					{
<span class="nc" id="L305">						System.out.println(&quot;Bad Char:(&quot; + character + &quot;)&quot;);</span>
<span class="nc" id="L306">						fret = 0;</span>
					}
<span class="fc bfc" id="L308" title="All 2 branches covered.">					if (!chord) {</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">						if (tunner.getNote(tune[line-1], fret, line).substring(tunner.getNote(tune[line-1], fret, line).length()-1,tunner.getNote(tune[line-1], fret, line).length()).equals(&quot;#&quot;)){</span>
<span class="fc" id="L310">							sharpnote = true;</span>
						}


<span class="fc" id="L314">						fileGen.addNote(line, fret, tunner.getNote(tune[line-1], fret, line).charAt(0), noteType(beatNote), getDuration(beatNote), tunner.getOctave(tune[line-1], fret, line), dot(beatNote),sharpnote, hammerStart,hammerContinue,hammerDone,harmonic);</span>
<span class="fc" id="L315">						harmonic = false;</span>
<span class="fc" id="L316">						System.out.println(&quot;&quot;);</span>
<span class="fc" id="L317">						System.out.println(&quot;Dash: &quot; + dash);</span>
<span class="fc" id="L318">						System.out.println(&quot;Duration: &quot; + getDuration(beatNote));</span>
<span class="fc" id="L319">						System.out.println(&quot;&quot;);</span>
<span class="pc bpc" id="L320" title="1 of 2 branches missed.">						if(rest &gt; 0) {</span>
<span class="nc" id="L321">							fileGen.addRest(getDuration(rest), noteType(rest));</span>
<span class="nc" id="L322">							System.out.println(&quot;&quot;);</span>
<span class="nc" id="L323">							System.out.println(&quot;RestDuration : &quot; + getDuration(rest));</span>
<span class="nc" id="L324">							System.out.println(&quot;RestType : &quot; + noteType(rest));</span>
<span class="nc" id="L325">							System.out.println(&quot;&quot;);</span>
<span class="nc" id="L326">							rest = 0.0;</span>
						}
							
<span class="fc bfc" id="L329" title="All 2 branches covered.">						if(hammerOn){</span>
<span class="fc" id="L330">							hammerLength--;</span>
						}
<span class="fc" id="L332">						sharpnote = false;</span>

<span class="fc bfc" id="L334" title="All 2 branches covered.">						if(hammerStart){ // indicates that we have past first note of hammer on</span>
<span class="fc" id="L335">							hammerStart = false;</span>
<span class="fc" id="L336">							hammerContinue = true;</span>
						}
<span class="fc bfc" id="L338" title="All 2 branches covered.">						if(hammerLength == 1){ // indicates that the next note is the end of the hammer on</span>
<span class="fc" id="L339">							hammerContinue = false;</span>
<span class="fc" id="L340">							hammerDone = true;</span>
						}
<span class="fc bfc" id="L342" title="All 2 branches covered.">						if (hammerLength == 0 ){ // indicates that the hammer on is over and back to regular scheduled programming</span>
<span class="fc" id="L343">							hammerDone = false;</span>
<span class="fc" id="L344">							hammerOn = false;</span>
<span class="fc" id="L345">							hammerDuration = 0;</span>
<span class="fc" id="L346">							hammerLength = 0;</span>
						}

					}
                    else {
<span class="pc bpc" id="L351" title="2 of 4 branches missed.">                    	if (i-1&gt;0 &amp;&amp; columns.get(i-1)[j] == '[') {</span>
<span class="nc" id="L352">    						hchord[j] = true;</span>
    					}
<span class="fc" id="L354">						linearray[j] = line;</span>
<span class="fc" id="L355">						fretarray[j] = fret;</span>
<span class="fc" id="L356">						note = tunner.getNote(tune[line-1], fret, line).charAt(0);</span>
<span class="fc" id="L357">						chordOctave = tunner.getOctave(tune[line-1], fret, line);</span>
<span class="fc" id="L358">						chords[j] = note;</span>
<span class="fc" id="L359">						chordsOctave[j] = chordOctave;</span>
<span class="fc" id="L360">						chordType = noteType(beatNote);</span>
<span class="fc" id="L361">						chordDot[j] = dot(beatNote);</span>
<span class="fc bfc" id="L362" title="All 2 branches covered.">						if (tunner.getNote(tune[line-1], fret, line).substring(tunner.getNote(tune[line-1], fret, line).length()-1,tunner.getNote(tune[line-1], fret, line).length()).equals(&quot;#&quot;)){</span>
<span class="fc" id="L363">							sharp[j] = true;</span>
						}
						else 
<span class="fc" id="L366">							sharp[j] = false;</span>
					}
				}
<span class="fc bfc" id="L369" title="All 2 branches covered.">				if (line == stringAmount) {</span>
<span class="fc" id="L370">					line = 0;</span>
				}	
			}
			
			
			//Chord
<span class="fc bfc" id="L376" title="All 2 branches covered.">			if (chord) {</span>
				double beatNote;
<span class="pc bpc" id="L378" title="1 of 2 branches missed.">				if(hammerOn){</span>
<span class="nc" id="L379">					beatNote = beatNote((hammerDuration * totalBeatPerMeasure)/totalDash);/*beatNote((hammerDuration * beatTypeNote)/div);*/</span>
<span class="nc" id="L380">					totalNote += beatNote;</span>
				}
				else {
<span class="fc" id="L383">					beatNote = beatNote((dash * totalBeatPerMeasure)/totalDash);/*beatNote((dash * beatTypeNote)/div)*/</span>
				}

<span class="fc" id="L386">				fileGen.addChord(chords,chordType, getDuration(beatNote), chordsOctave,linearray,fretarray, chordDot,sharp,hammerLocation,hammerStart,hammerContinue,hammerDone,hchord);</span>
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">				if(rest &gt; 0) {</span>
<span class="nc" id="L388">					fileGen.addRest(getDuration(rest), noteType(rest));</span>
<span class="nc" id="L389">					System.out.println(&quot;&quot;);</span>
<span class="nc" id="L390">					System.out.println(&quot;RestDuration : &quot; + getDuration(rest));</span>
<span class="nc" id="L391">					System.out.println(&quot;RestType : &quot; + noteType(rest));</span>
<span class="nc" id="L392">					System.out.println(&quot;&quot;);</span>
<span class="nc" id="L393">					rest = 0.0;</span>
				}
<span class="fc" id="L395">				linearray = new int[stringAmount];</span>
<span class="fc" id="L396">				fretarray = new int[stringAmount];</span>
<span class="fc" id="L397">				chords = new char[stringAmount];</span>
<span class="fc" id="L398">				chordsOctave = new int[stringAmount];</span>
<span class="fc" id="L399">				chordDot = new int[stringAmount];</span>
<span class="pc bpc" id="L400" title="1 of 2 branches missed.">				if(hammerOn){</span>
<span class="nc" id="L401">					hammerLength--;</span>
				}
<span class="pc bpc" id="L403" title="1 of 2 branches missed.">				if(hammerStart){ // indicates that we have past first note of hammer on</span>
<span class="nc" id="L404">					hammerStart = false;</span>
<span class="nc" id="L405">					hammerContinue = true;</span>
				}
<span class="pc bpc" id="L407" title="1 of 2 branches missed.">				if(hammerLength == 1){ // indicates that the next note is the end of the hammer on</span>
<span class="nc" id="L408">					hammerContinue = false;</span>
<span class="nc" id="L409">					hammerDone = true;</span>
				}
<span class="pc bpc" id="L411" title="1 of 2 branches missed.">				if (hammerLength == 0 ){ // indicates that the hammer on is over and back to regular scheduled programming</span>
<span class="fc" id="L412">					hammerDone = false;</span>
<span class="fc" id="L413">					hammerOn = false;</span>
<span class="fc" id="L414">					hammerDuration = 0;</span>
<span class="fc" id="L415">					hammerLength = 0;</span>
				}
			}
			
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">			if(doubleDigitColumn) { //Skip next line if double digit</span>
<span class="nc" id="L420">				i++;</span>
<span class="nc" id="L421">				currentColumn++;</span>
			}
			
<span class="fc" id="L424">			currentColumn++;</span>
		}
		
		//End the musicxml file
<span class="pc bpc" id="L428" title="1 of 2 branches missed.">		if(fileGen.measureOpen)</span>
<span class="nc" id="L429">			fileGen.closeMeasure();</span>
<span class="pc bpc" id="L430" title="1 of 2 branches missed.">		if(fileGen.partOpen)</span>
<span class="fc" id="L431">			fileGen.closePart();</span>
<span class="fc" id="L432">		fileGen.end();</span>
		
<span class="fc" id="L434">		new SuccessPopUp(Main.myFrame, FileGenerator.filepath);</span>
<span class="fc" id="L435">	}</span>
	
	private boolean containsOnlyChar(char[] cs, char o) {
<span class="fc" id="L438">		boolean output = true;</span>
		
<span class="fc bfc" id="L440" title="All 2 branches covered.">		for(Object t : cs) {</span>
<span class="pc bpc" id="L441" title="2 of 12 branches missed.">			output = (output &amp;&amp; t.equals(o)) || (output &amp;&amp; t.equals('[')) || (output &amp;&amp; t.equals(']'));</span>
		}
		
<span class="fc" id="L444">		return output;</span>
	}

	private int hamererOnDuration(char afterhammer, int i){
<span class="pc bpc" id="L448" title="2 of 4 branches missed.">		if( afterhammer!= '-' &amp;&amp; afterhammer != '|') {</span>
<span class="fc" id="L449">			int dash = 1;</span>
			boolean test;
<span class="fc bfc" id="L451" title="All 2 branches covered.">			for(int k = i+1; k &lt; columns.size()-1; k++) {</span>
<span class="pc bpc" id="L452" title="1 of 2 branches missed.">				if(!containsOnlyChar(columns.get(k), '|'))</span>
				{
<span class="fc" id="L454">					test = containsOnlyChar(columns.get(k), '-');</span>
<span class="fc bfc" id="L455" title="All 2 branches covered.">					if(test) {</span>
<span class="fc" id="L456">						dash++;</span>
					}else {
						break;
					}
				}
				else
					break;
			}
<span class="fc" id="L464">			return dash;</span>
		}
<span class="nc" id="L466">		return 1;</span>
	}

	private boolean containsOnlyInt(int[] cs, int o) {
<span class="fc" id="L470">		boolean output = true;</span>
		
<span class="fc bfc" id="L472" title="All 2 branches covered.">		for(Object t : cs) {</span>
<span class="pc bpc" id="L473" title="2 of 4 branches missed.">			output = output &amp;&amp; t.equals(o) ;</span>
		}
		
<span class="fc" id="L476">		return output;</span>
	}
	
	private boolean containsOnlyString(String[] cs, String o) {
<span class="fc" id="L480">		boolean output = true;</span>
		
<span class="fc bfc" id="L482" title="All 2 branches covered.">		for(Object t : cs) {</span>
<span class="fc bfc" id="L483" title="All 4 branches covered.">			output = output &amp;&amp; t.equals(o) ;</span>
		}
		
<span class="fc" id="L486">		return output;</span>
	}
	
	private int dot(double beatNote) {
<span class="fc" id="L490">		System.out.println(&quot;&quot;);</span>
<span class="fc" id="L491">		System.out.println(&quot;DotBeatNote: &quot; + beatNote);</span>
<span class="fc" id="L492">		int output = 0;</span>
<span class="fc" id="L493">		double check = 0.0;</span>
<span class="fc" id="L494">		double check2 = 0.0;</span>
		double temp;
<span class="fc" id="L496">		double div = 2.0;</span>
<span class="pc bpc" id="L497" title="1 of 2 branches missed.">		for(double i = 2.0; i &gt; 0.0; i = i/2.0) {</span>
<span class="fc bfc" id="L498" title="All 2 branches covered.">			if(beatNote &gt;= i) {</span>
<span class="fc" id="L499">				check = i;</span>
<span class="fc" id="L500">				break;</span>
			}
		}
		
<span class="fc" id="L504">		System.out.println(&quot;DotCheck: &quot; + check);</span>
<span class="fc" id="L505">		temp = check;</span>
<span class="fc" id="L506">		check2 = check;</span>
		
		while(true) {
<span class="fc" id="L509">			check = check + temp/div;</span>
<span class="pc bpc" id="L510" title="1 of 4 branches missed.">			if(check2 &lt; beatNote &amp;&amp; beatNote &gt; check) {</span>
<span class="nc" id="L511">				System.out.println(check2 + &quot; &lt; &quot; + beatNote + &quot; &gt; &quot; + check);</span>
<span class="nc" id="L512">				output++;</span>
<span class="fc bfc" id="L513" title="All 2 branches covered.">			}else if(beatNote == check) {</span>
<span class="fc" id="L514">				System.out.println(beatNote + &quot; == &quot; + check);</span>
<span class="fc" id="L515">				output++;</span>
<span class="fc" id="L516">				break;</span>
<span class="pc bpc" id="L517" title="1 of 2 branches missed.">			}else if(beatNote &lt; check) {</span>
<span class="pc bpc" id="L518" title="1 of 2 branches missed.">				if(check - beatNote &lt; check - check2) {</span>
					//add the rest here
<span class="nc" id="L520">					rest = beatNote(beatNote - check2);</span>
<span class="nc" id="L521">					System.out.println(&quot;DotRest: &quot; + rest);</span>
				}else {
					break;
				}
			}
<span class="nc" id="L526">			check2 = check2 + temp/div;</span>
<span class="nc" id="L527">			div *= 2;</span>
			}
<span class="fc" id="L529">		System.out.println(&quot;&quot;);</span>
<span class="fc" id="L530">		return output;</span>
		}

	
	private double beatNote(double b) {
<span class="fc" id="L535">		double output = 0.0;</span>
		
<span class="fc" id="L537">		System.out.println(&quot;BeatNote: &quot; + b);</span>
<span class="fc bfc" id="L538" title="All 2 branches covered.">		if(b &gt;= 1.0/256) {</span>
<span class="pc bpc" id="L539" title="1 of 2 branches missed.">			if(b &gt;= 2.0) {</span>
<span class="nc" id="L540">				output = 2.0;</span>
<span class="nc" id="L541">				output += beatNote(b - output);</span>
<span class="fc bfc" id="L542" title="All 2 branches covered.">			}else if(b &gt;= 1.0) {</span>
<span class="fc" id="L543">				output = 1.0;</span>
<span class="fc" id="L544">				output += beatNote(b - output);</span>
<span class="fc bfc" id="L545" title="All 2 branches covered.">			}else if(b &gt;= 1.0/2.0) {</span>
<span class="fc" id="L546">				output = 1.0/2;</span>
<span class="fc" id="L547">				output += beatNote(b - output);</span>
<span class="fc bfc" id="L548" title="All 2 branches covered.">			}else if(b &gt;= 1.0/4.0) {</span>
<span class="fc" id="L549">				output = 1.0/4;</span>
<span class="fc" id="L550">				output += beatNote(b - output);</span>
<span class="pc bpc" id="L551" title="1 of 2 branches missed.">			}else if(b  &gt;= 1.0/8.0) {</span>
<span class="fc" id="L552">				output = 1.0/8;</span>
<span class="fc" id="L553">				output += beatNote(b - output);</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">			}else if(b &lt; 1.0/8.0) {</span>
<span class="nc" id="L555">				double div = ((1.0/8.0)/b);</span>
<span class="nc" id="L556">				int maxIndex = 0;</span>
<span class="nc" id="L557">				double power = 0.0;</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">				if(div % 2 != 0.0) {</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">					while(div % 2 != 0.0) {</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">						if(div &lt; Math.pow(2.0, power)) {</span>
<span class="nc" id="L561">							div = (int) Math.pow(2, power);</span>
						}else {
<span class="nc" id="L563">							power += 1.0;</span>
						}
					}
				}
<span class="nc" id="L567">				System.out.println(&quot;Power: &quot; + power);</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">				while(div != 1) {</span>
<span class="nc" id="L569">					div = div/2;</span>
<span class="nc" id="L570">					maxIndex++;</span>
				}
<span class="nc" id="L572">				int temp = (int)(Math.pow(2, maxIndex) * 8);</span>
<span class="nc" id="L573">				output = 1.0/temp;</span>
<span class="nc" id="L574">				System.out.println(&quot;Temp: &quot; + temp);</span>
<span class="nc" id="L575">				output += beatNote(b - output);</span>
			}
		}
		
<span class="fc" id="L579">		System.out.println(&quot;BeatNoteOut: &quot; + output);</span>
		
<span class="fc" id="L581">		return output;</span>
		}
	
	protected static String noteType(double beatNote) {
<span class="fc" id="L585">		String output = &quot;&quot;;</span>
		
<span class="fc bfc" id="L587" title="All 2 branches covered.">		if(beatNote &gt;= 1.0) {</span>
<span class="fc" id="L588">			output = &quot;whole&quot;;</span>
<span class="fc bfc" id="L589" title="All 2 branches covered.">		}else if(beatNote &gt;= 1.0/2.0) {</span>
<span class="fc" id="L590">			output = &quot;half&quot;;</span>
<span class="fc bfc" id="L591" title="All 2 branches covered.">		}else if(beatNote &gt;= 1.0/4.0) {</span>
<span class="fc" id="L592">			output = &quot;quarter&quot;;</span>
<span class="fc bfc" id="L593" title="All 2 branches covered.">		}else if(beatNote  &gt;= 1.0/8.0) {</span>
<span class="fc" id="L594">			output = &quot;eighth&quot;;</span>
<span class="pc bpc" id="L595" title="1 of 2 branches missed.">		}else if(beatNote &lt; 1.0/8.0) {</span>
<span class="fc" id="L596">			int div = (int) ((1.0/8.0)/beatNote);</span>
<span class="fc" id="L597">			int maxIndex = 0;</span>
<span class="fc" id="L598">			double power = 0.0;</span>
<span class="pc bpc" id="L599" title="1 of 2 branches missed.">			if(div % 2 != 0) {</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">				while(div % 2 != 0) {</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">					if(div &lt; Math.pow(2.0, power)) {</span>
<span class="nc" id="L602">						div = (int) Math.pow(2, power);</span>
					}else {
<span class="nc" id="L604">						power = power + 1.0;</span>
					}
				}
			}
<span class="fc bfc" id="L608" title="All 2 branches covered.">			while(div != 1) {</span>
<span class="fc" id="L609">				div = div/2;</span>
<span class="fc" id="L610">				maxIndex++;</span>
			}
<span class="fc" id="L612">			int temp = (int)(Math.pow(2, maxIndex) * 8);</span>
<span class="fc" id="L613">			output = output + temp;</span>
<span class="fc" id="L614">			int lastTwo = Integer.parseInt(output.substring(output.length()-2));</span>
<span class="pc bpc" id="L615" title="1 of 2 branches missed.">			if(output.charAt(output.length()-1) == '1') {</span>
<span class="nc" id="L616">				output = output + &quot;st&quot;;</span>
<span class="pc bpc" id="L617" title="1 of 4 branches missed.">			}else if(11 &lt;= lastTwo &amp;&amp; lastTwo &lt;= 19) {</span>
<span class="fc" id="L618">				output = output + &quot;th&quot;;</span>
<span class="fc bfc" id="L619" title="All 2 branches covered.">			}else if(output.charAt(output.length()-1) == '2') {</span>
<span class="fc" id="L620">				output = output + &quot;nd&quot;;</span>
<span class="pc bpc" id="L621" title="1 of 2 branches missed.">			}else if(output.charAt(output.length()-1) == '3') {</span>
<span class="nc" id="L622">				output = output + &quot;rd&quot;;</span>
			}else {
<span class="fc" id="L624">				output = output + &quot;th&quot;;</span>
			}
		}
<span class="fc" id="L627">		return output;</span>
	}
	
	private int getDuration(double noteType) {
<span class="fc" id="L631">		double output = 0;</span>
<span class="fc" id="L632">		double div = getDivisions(beat);</span>
<span class="fc" id="L633">		double beatTypeNote = 1.0/beatType;</span>
<span class="fc" id="L634">		output = (noteType * div)/beatTypeNote;</span>
<span class="fc" id="L635">		System.out.println(&quot;DurationOutput: &quot; + output);</span>
<span class="pc bpc" id="L636" title="1 of 2 branches missed.">		if(output%0.5 == 0)</span>
<span class="fc" id="L637">			return (int)output;</span>
		else
<span class="nc" id="L639">			return (int)Math.round(output);</span>
	}
	
	private double noteFromDash(int d) {
<span class="nc" id="L643">		double output = 0.0;</span>
		
<span class="nc" id="L645">		output = ((1.0 * beat/beatType)*d)/totalDash;</span>
		
<span class="nc" id="L647">		return output;</span>
	}
	
	private int getDivisions(int beatSig) {
<span class="fc" id="L651">		int hyfenNumber = 0;</span>
<span class="fc" id="L652">		int boundary = 0;</span>
<span class="fc" id="L653">		int value = 0;</span>
<span class="fc" id="L654">		int doubleDigit = 0;</span>
		//System.out.println(&quot;&quot;);
		
<span class="pc bpc" id="L657" title="1 of 2 branches missed.">		for(int i = 0; i &lt; columns.size(); i++) {</span>
<span class="fc bfc" id="L658" title="All 2 branches covered.">			if(containsOnlyChar(columns.get(i), '-')) {</span>
				//System.out.println(&quot;Dash&quot;);
			}
<span class="fc bfc" id="L661" title="All 2 branches covered.">			if(containsOnlyChar(columns.get(i), '|')) {</span>
<span class="fc" id="L662">				boundary++;</span>
				//System.out.println(&quot;Boundary&quot;);
			}
<span class="fc bfc" id="L665" title="All 2 branches covered.">			if(boundary == 2) {</span>
				//System.out.println(&quot;Break&quot;);
<span class="fc" id="L667">				break;</span>
			}
<span class="fc bfc" id="L669" title="All 2 branches covered.">			if(!containsOnlyChar(columns.get(i), '-')) {</span>
<span class="fc" id="L670">				value++;</span>
<span class="pc bpc" id="L671" title="1 of 2 branches missed.">				if(doubleDigit(columns.get(i), columns.get(i+1)))</span>
<span class="nc" id="L672">					doubleDigit++;</span>
<span class="fc" id="L673">				System.out.println(&quot;Value: &quot; + value);</span>
			}
<span class="pc bpc" id="L675" title="1 of 4 branches missed.">			if(boundary == 1 &amp;&amp; value &gt; 1) {				</span>
<span class="fc" id="L676">				hyfenNumber++;</span>
				//System.out.println(&quot;Hyfen Increase: &quot; + hyfenNumber);
			}
		}
<span class="fc" id="L680">		hyfenNumber -= doubleDigit;</span>
<span class="fc" id="L681">		System.out.println(&quot;HyfenNumber: &quot; + hyfenNumber);</span>
<span class="fc" id="L682">		System.out.println(&quot;DoubleDigit: &quot; + doubleDigit);</span>
		/*
		for(int i=0;i&lt; columns.size();i++) {
			
			if(columns.get(i)[0] == '|'){
				boundary++;
			}
			if (boundary == 2) {
				break;
			}
			
			if(columns.get(i)[0] == '-' || columns.get(i)[0] == 'h') {
				hyfenNumber++;
				System.out.println(&quot;- || h&quot;);
			}
			else {
				if(i==0) {
				
				}
				else if(columns.get(i-1)[0] == 'h') {
					hyfenNumber++;
					System.out.println(&quot;h&quot;);
				}
				else if(columns.get(i-1)[0] != '-') {
					
				}
				else {
					hyfenNumber++;
					System.out.println(&quot;Else&quot;);
				}
		}
			}*/
		//System.out.println(&quot;&quot;);
<span class="fc" id="L715">		totalDash = hyfenNumber;</span>
<span class="fc" id="L716">		double beatNote = 1.0/beatType;</span>
<span class="fc" id="L717">		double bSig  = 1.0 * beatSig;</span>
<span class="fc" id="L718">		double totalBeatPerMeasure = bSig/beatType;</span>
<span class="fc" id="L719">		double division = (hyfenNumber * beatNote)/totalBeatPerMeasure;</span>
		//System.out.println(&quot;TBM: &quot; + totalBeatPerMeasure);
		//System.out.println(&quot;hyfen number is &quot;+hyfenNumber);
		//System.out.println(&quot;Division: &quot; + division);

<span class="pc bpc" id="L724" title="1 of 2 branches missed.">		if(division%0.5 == 0)</span>
<span class="fc" id="L725">            return (int)division;</span>
        else
<span class="nc" id="L727">            return (int)Math.round(division);</span>
	}
	
	private boolean doubleDigit(char[] b, char[] a) {
<span class="fc" id="L731">		String nb = &quot;&quot;;</span>
<span class="fc" id="L732">		String na = &quot;&quot;;</span>
<span class="fc" id="L733">		String n = &quot;&quot;;</span>
<span class="fc" id="L734">		boolean output = false;</span>
		
<span class="fc bfc" id="L736" title="All 2 branches covered.">		for(int i  = 0; i &lt; b.length; i++) {</span>
<span class="fc" id="L737">			nb = Character.toString(b[i]);</span>
<span class="fc" id="L738">			na = Character.toString(a[i]);</span>
<span class="fc" id="L739">			n = nb + na;</span>
			try {
<span class="nc" id="L741">				Integer.parseInt(n);</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">				output = output || true;</span>
<span class="fc" id="L743">			}catch(NumberFormatException e) {</span>
<span class="pc bpc" id="L744" title="1 of 2 branches missed.">				output = output || false;</span>
<span class="nc" id="L745">			}</span>
		}
<span class="fc" id="L747">		return output;</span>
	}

	static void addTitle(String title){
<span class="fc" id="L751">		misc.put(&quot;Title&quot;, title);</span>
<span class="fc" id="L752">	}</span>
	
	static void addInstrument(String instrument){
<span class="fc" id="L755">		misc.put(&quot;Instrument&quot;, instrument);</span>
<span class="fc" id="L756">	}</span>
	
	static void addTime(String timeSig){
<span class="fc" id="L759">		misc.put(&quot;TimeSig&quot;, timeSig);</span>
<span class="fc" id="L760">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>